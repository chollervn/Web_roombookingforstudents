<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
	th:replace="~{admin/admin_base::adminLayout(~{::section})}">
<head>
<meta charset="UTF-8">
<title>Quản lý đơn thuê trọ</title>
</head>
<body>
	<section th:with="currentPage='orders'">
		<style>
			.page-header {
				margin-bottom: 30px;
			}
			.page-header h2 {
				font-size: 28px;
				color: #2c3e50;
				margin-bottom: 10px;
			}
			.table-card {
				background: white;
				padding: 25px;
				border-radius: 12px;
				box-shadow: 0 2px 8px rgba(0,0,0,0.08);
			}
		</style>

		<div class="page-header">
			<h2><i class="fas fa-file-contract"></i> Trọ đang cho thuê</h2>
		</div>

		<th:block th:if="${session.succMsg}">
			<div class="alert alert-success alert-dismissible fade show">
				[[${session.succMsg}]]
				<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
			</div>
			<th:block th:text="${@commnServiceImpl.removeSessionMessage()}"></th:block>
		</th:block>

		<th:block th:if="${session.errorMsg}">
			<div class="alert alert-danger alert-dismissible fade show">
				[[${session.errorMsg}]]
				<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
			</div>
			<th:block th:text="${@commnServiceImpl.removeSessionMessage()}"></th:block>
		</th:block>

		<div class="table-card">
			<div class="table-responsive">
				<table class="table table-bordered table-hover">
					<thead class="table-light">
						<tr>
							<th>Phòng trọ</th>
							<th>Người thuê</th>
							<th>Ngày thuê</th>
							<th>Ngày hết hạn</th>
							<th>Giá thuê</th>
							<th>Số tháng</th>
							<th>Tổng tiền</th>
							<th>Hành động</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="order : ${orders}" th:if="${order.status eq 'RENTED'}">
							<td>
								<strong>[[${order.room.roomName}]]</strong><br>
								<small class="text-muted">[[${order.room.address}]]</small>
							</td>
							<td>
								<strong>[[${order.user.name}]]</strong><br>
								<small class="text-muted">
									<i class="fas fa-envelope"></i> [[${order.user.email}]]<br>
									<i class="fas fa-phone"></i> [[${order.user.mobileNumber}]]
								</small>
							</td>
							<td>[[${#temporals.format(order.orderDate, 'dd/MM/yyyy')}]]</td>
							<td>
								<span th:text="${#temporals.format(order.orderDate.plusMonths(order.quantity), 'dd/MM/yyyy')}"></span>
							</td>
							<td>[[${#numbers.formatDecimal(order.price, 0, 'COMMA', 0, 'POINT')}]] VNĐ/tháng</td>
							<td>[[${order.quantity}]] tháng</td>
							<td>
								<strong>[[${#numbers.formatDecimal(order.quantity * order.price, 0, 'COMMA', 0, 'POINT')}]] VNĐ</strong>
							</td>
							<td>
								<form th:action="@{/admin/cancel-rent}" method="post" style="display:inline;">
									<input type="hidden" name="orderId" th:value="${order.id}">
									<button type="submit" class="btn btn-sm btn-danger"
										onclick="return confirm('Bạn có chắc muốn hủy cho thuê?')">
										<i class="fas fa-times"></i> Hủy cho thuê
									</button>
								</form>
							</td>
						</tr>
						<tr th:if="${#lists.isEmpty(orders)}">
							<td colspan="8" class="text-center py-5">
								<div class="text-muted">
									<i class="fas fa-info-circle fa-3x mb-3"></i>
									<h5>Chưa có trọ đang cho thuê</h5>
									<p>Khi có người thuê trọ và được bạn chấp nhận, thông tin sẽ hiển thị ở đây.</p>
								</div>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</section>
</body>
</html>