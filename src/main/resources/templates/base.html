<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" th:fragment="layout(content)">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>H·ªá th·ªëng cho thu√™ ph√≤ng tr·ªç sinh vi√™n</title>

	<!-- Bootstrap CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
		integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
		crossorigin="anonymous" referrerpolicy="no-referrer" />

	<!-- Custom CSS -->
	<link rel="stylesheet" href="/css/style.css">

	<!-- Fixed styling to prevent flickering -->
	<style>
		/* Reset and stable fonts */
		body {
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
			line-height: 1.5;
			-webkit-font-smoothing: antialiased;
			-moz-osx-font-smoothing: grayscale;
		}

		/* Remove all transitions that cause flickering */
		*,
		*::before,
		*::after {
			transition: none !important;
			animation: none !important;
		}

		.navbar-brand {
			font-weight: 600;
		}

		.card-sh {
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
			border: 1px solid #e0e0e0;
		}

		/* Stable table styling */
		.table {
			table-layout: fixed;
			width: 100%;
		}

		/* Prevent button hover effects that cause flickering */
		.btn {
			transition: none !important;
		}

		.btn:hover {
			transform: none !important;
		}

		/* Fix image loading flicker */
		img {
			display: block;
			max-width: 100%;
			height: auto;
		}

		.img-thumbnail {
			border: 1px solid #dee2e6;
			border-radius: 0.375rem;
			padding: 0.25rem;
			background-color: #fff;
		}
	</style>
</head>

<body>
	<!-- Start Navbar  -->
	<nav class="navbar navbar-expand-lg bg-primary fixed-top navbar-dark">
		<div class="container-fluid">
			<a class="navbar-brand" href="#"><i class="fa-solid fa-home"></i> PhongTroSV.com</a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse"
				data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
				aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarSupportedContent">
				<ul class="navbar-nav me-auto mb-2 mb-lg-0">
					<th:block th:if="${user==null}">
						<li class="nav-item"><a class="nav-link active" aria-current="page" href="/"><i
									class="fa-solid fa-house"></i>
								Trang ch·ªß</a></li>
					</th:block>

					<th:block th:unless="${user==null}">
						<li class="nav-item" th:if="${user.role=='ROLE_ADMIN'}"><a class="nav-link active"
								aria-current="page" href="/admin/"><i class="fa-solid fa-house"></i> Trang ch·ªß</a></li>

						<li class="nav-item" th:if="${user.role=='ROLE_OWNER'}"><a class="nav-link active"
								aria-current="page" href="/admin/"><i class="fa-solid fa-house"></i> Trang ch·ªß</a></li>

						<li class="nav-item" th:if="${user.role=='ROLE_USER'}"><a class="nav-link active"
								aria-current="page" href="/"><i class="fa-solid fa-house"></i> Trang ch·ªß</a></li>
					</th:block>

					<li class="nav-item"><a class="nav-link active" aria-current="page" href="/rooms"><i
								class="fa-solid fa-bed"></i> Ph√≤ng tr·ªç</a></li>

					<li class="nav-item"><a class="nav-link active" aria-current="page" href="/minigame/duck-race"><i
								class="fa-solid fa-gamepad"></i> Minigame üéÆ</a></li>

				</ul>

				<ul class="navbar-nav ms-auto mb-2 mb-lg-0">
					<th:block th:if="${user==null}">
						<li class="nav-item"><a class="nav-link active" aria-current="page" href="/signin"><i
									class="fa-solid fa-right-to-bracket"></i> ƒêƒÇNG NH·∫¨P</a></li>
						<li class="nav-item"><a class="nav-link active" aria-current="page" href="/register"><i
									class="fa-solid fa-user-plus"></i> ƒêƒÇNG K√ù</a></li>
					</th:block>

					<th:block th:if="${user!=null}">
						<th:block th:if="${user.role=='ROLE_USER'}">
							<li class="nav-item"><a class="nav-link active" aria-current="page" href="/user/cart">
									<i class="fa-solid fa-calendar-check"></i> ƒê√£ xem [ [[${countCart}]] ]
									<span
										th:if="${unreadDepositNotifications != null and unreadDepositNotifications > 0}"
										class="badge bg-danger rounded-pill ms-1" style="font-size: 0.7rem;">
										[[${unreadDepositNotifications}]]
									</span>
								</a></li>
						</th:block>

						<th:block th:if="${user.role=='ROLE_USER'}">
							<li class="nav-item dropdown">
								<a class="nav-link active dropdown-toggle" href="#" role="button"
									data-bs-toggle="dropdown" aria-expanded="false">
									<i class="fa-solid fa-bell"></i>
									<span th:if="${unreadNotifications != null and unreadNotifications > 0}"
										class="badge bg-danger rounded-pill ms-1" style="font-size: 0.7rem;">
										[[${unreadNotifications}]]
									</span>
								</a>
								<ul class="dropdown-menu dropdown-menu-end"
									style="min-width: 300px; max-height: 400px; overflow-y: auto;">
									<li>
										<h6 class="dropdown-header">Th√¥ng b√°o</h6>
									</li>
									<li>
										<hr class="dropdown-divider">
									</li>

									<th:block th:if="${recentNotifications != null and !recentNotifications.isEmpty()}">
										<li th:each="n : ${recentNotifications}">
											<a class="dropdown-item" href="/user/notifications"
												style="white-space: normal;">
												<div class="d-flex justify-content-between align-items-start">
													<div>
														<small class="fw-bold"
															th:text="${n.type == 'IN_APP' ? 'H·ªá th·ªëng' : (n.type == 'EMAIL' ? 'Email' : 'SMS')}"></small>
														<span th:if="${n.status != 'READ'}" class="badge bg-danger ms-1"
															style="font-size: 0.6em;">NEW</span>
													</div>
													<small class="text-muted" style="font-size: 0.7em;"
														th:text="${#temporals.format(n.sentDate, 'dd/MM HH:mm')}"></small>
												</div>
												<p class="mb-0 small text-truncate" style="max-width: 250px;">
													[[${n.message}]]</p>
											</a>
										</li>
										<li>
											<hr class="dropdown-divider">
										</li>
									</th:block>

									<th:block th:if="${recentNotifications == null or recentNotifications.isEmpty()}">
										<li>
											<p class="dropdown-item text-center small text-muted">Kh√¥ng c√≥ th√¥ng b√°o m·ªõi
											</p>
										</li>
										<li>
											<hr class="dropdown-divider">
										</li>
									</th:block>

									<li><a class="dropdown-item text-center small" href="/user/notifications">Xem t·∫•t c·∫£
											th√¥ng b√°o</a></li>
								</ul>
							</li>
						</th:block>

						<th:block th:if="${user.role=='ROLE_ADMIN' or user.role=='ROLE_OWNER'}">
							<li class="nav-item"><a class="nav-link active" aria-current="page" href="/admin/deposits">
									<i class="fa-solid fa-money-bill-wave"></i> Qu·∫£n l√Ω ƒë·∫∑t c·ªçc
									<span th:if="${pendingDepositCount != null and pendingDepositCount > 0}"
										class="badge bg-danger rounded-pill ms-1" style="font-size: 0.7rem;">
										[[${pendingDepositCount}]]
									</span>
								</a></li>
						</th:block>

						<li class="nav-item dropdown"><a class="nav-link dropdown-toggle active" href="#" role="button"
								data-bs-toggle="dropdown" aria-expanded="false"> <i class="fa-solid fa-user"></i>
								[[${user.name}]]
							</a>
							<ul class="dropdown-menu">
								<li th:if="${user.role=='ROLE_USER'}"><a class="dropdown-item" href="/user/profile"><i
											class="fa-solid fa-user"></i> H·ªì s∆°</a></li>

								<li th:if="${user.role=='ROLE_ADMIN' or user.role=='ROLE_OWNER'}"><a
										class="dropdown-item" href="/admin/profile"><i class="fa-solid fa-user"></i> H·ªì
										s∆°</a></li>

								<li th:if="${user.role=='ROLE_USER'}"><a class="dropdown-item" href="/user/my-rental"><i
											class="fa-solid fa-home"></i> Tr·ªç c·ªßa t√¥i</a></li>

								<li th:if="${user.role=='ROLE_USER'}"><a class="dropdown-item"
										href="/user/user-orders"><i class="fa-solid fa-list"></i> ƒê∆°n thu√™ c·ªßa t√¥i</a>
								</li>
								<li><a class="dropdown-item" href="/logout"><i +
											class="fa-solid fa-right-from-bracket"></i> ƒêƒÉng xu·∫•t</a></li>
								<li>
									<hr class="dropdown-divider">
								</li>
							</ul>
						</li>
					</th:block>
				</ul>
			</div>
		</div>
	</nav>
	<!-- End Navbar -->

	<div th:replace="${content}"></div>

	<!-- Start Footer -->
	<div class="container-fluid p-3 bg-primary text-center text-white" style="margin-top: 100px">
		<div class="row">
			<div class="col-md-4">
				<h5><i class="fa-solid fa-home"></i> PhongTroSV.com</h5>
				<p>H·ªá th·ªëng cho thu√™ ph√≤ng tr·ªç sinh vi√™n uy t√≠n, ch·∫•t l∆∞·ª£ng t·∫°i mi·ªÅn B·∫Øc Vi·ªát Nam</p>
			</div>
			<div class="col-md-4">
				<h6>Li√™n h·ªá</h6>
				<p><i class="fa-solid fa-phone"></i> Hotline: 1900-1234</p>
				<p><i class="fa-solid fa-envelope"></i> Email: support@phongtrosv.com</p>
			</div>
			<div class="col-md-4">
				<h6>Khu v·ª±c ph·ª•c v·ª•</h6>
				<p>H√† N·ªôi ‚Ä¢ H·∫£i Ph√≤ng ‚Ä¢ Th√°i Nguy√™n</p>
				<p>B·∫Øc Ninh ‚Ä¢ Vƒ©nh Ph√∫c ‚Ä¢ H∆∞ng Y√™n</p>
			</div>
		</div>
		<hr class="text-white">
		<p>&copy; 2025 PhongTroSV.com - B·∫£n quy·ªÅn thu·ªôc v·ªÅ h·ªá th·ªëng cho thu√™ ph√≤ng tr·ªç sinh vi√™n</p>
	</div>
	<!-- End Footer  -->

	<!-- Scripts at bottom for better performance -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.5/dist/jquery.validate.js"></script>
	<!-- Only load custom script once -->
	<script type="text/javascript" src="/js/script.js"></script>

	<!-- Prevent any lingering animations -->
	<script>
		// Disable all CSS animations and transitions globally
		document.addEventListener('DOMContentLoaded', function () {
			var css = '*, *::before, *::after { transition: none !important; animation: none !important; }';
			var style = document.createElement('style');
			style.type = 'text/css';
			style.appendChild(document.createTextNode(css));
			document.head.appendChild(style);
		});
	</script>
</body>

</html>